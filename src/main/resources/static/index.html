<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <title>AI Assistant Plus</title>
    <link rel="icon" href="lk_ico.png" type="image/png">
    <style>

        ::-webkit-scrollbar {
            width: 7px;
            height: 7px;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }

        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            font-family: 'Roboto', sans-serif;
            background-color: grey;
        }

        .title{
            font-size: 3em;
            line-height: 1.5;
            color: white;
        }

        .content{
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 50%;
            min-height: 50%;
            max-height: 80%;
			border: 1px solid #ccc;
            background-color: white;
            padding: 10px;
            box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        #chatBox {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
            border: none;
            background-color: white;
            overflow-y: auto;
            padding: 0px 10px 10px 10px;
        }

        #chatBox > p {
            font-size: 1em;
            padding: 10px;
            margin: 5px 0;
            min-width: fit-content;
            max-width: 90%;
            border-radius: 10px;
            box-shadow: 2px 2px 5px #888888;
        }

        #chatBox > p:nth-child(odd) {
            background-color: #483D8B;
            color: #f8f8ff;
            align-self: flex-start;
        }

        #chatBox > p:nth-child(even) {
            background-color: #20B2AA;
            color: #f8f8ff;
            align-self: flex-end;
        }

        p pre{
            position: relative;
            line-height: 1.25rem;
            color: #f8f8ff;
            background-color: #2b2b2b;
            border-radius: 5px;
            padding: 10px;
            box-shadow: 2px 2px 5px black;
            max-height: 300px;
            overflow: auto;
        }

        p pre .copy-button {
            position: absolute;
            top: 5px;
            right: 5px;
            padding: 5px 10px;
            background-color: #20B2AA;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        p > code{
            line-height: 1.25rem;
            color: #f8f8ff;
            background-color: #2b2b2b;
            border-radius: 3px;
            box-shadow: 2px 2px 5px black;
            max-height: 300px;
            overflow: auto;
            margin: 5px;
            font-size: 14px;
        }

        .toolBox {
			display: flex;
            flex-direction: row;
			justify-content: space-between;
			width: 100%;
			padding: 5px 0px 0px 0px;
		}

		.toolBox button{
			width: 2.5em;
			height: 2.5em;
			border: 1px solid #ccc;
            border-radius: 5px;
		}

        .inputBox {
            display: flex;
            flex-direction: row;
			height: 5em;
            width: 100%;
            margin: 5px;
			border: 1px solid #ccc;
			border-width: 1px 0 0 0;
            background-color: white;
            padding: 10px;
            resize: none;
            outline: none;
		}

		.inputBox textarea{
			height: 100%;
            width: 100%;
			border: none;
            background-color: white;
            overflow-y: auto;
            font-size: 1em;
            font-family: 'Roboto', sans-serif;
            resize: none;
            outline: none;
            border: none;
		}

		.inputBox button {
			width: 2.5em;
			height: 2.5em;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #009688;
            border: none;
            color: white;
            font-size: 1em;
            box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            cursor: pointer;
            margin-top: auto;
        }

        button:hover {
            box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.4);
            transform: scale(1.05);
            transition: all 0.2s;
        }

        @media (max-width: 1080px) {
            .content {
                width: 80%;
                height: 80%;
            }
            #chatBox > p {
                font-size: 2em;
            }
            .toolBox button{
                width: 6em;
                height: 6em;
            }
            .inputBox {
			    height: 8em;
            }
            .inputBox textarea{
                font-size: 2em;
            }
            .inputBox button {
                font-size: 2em;
            }
        }


    </style>
</head>

<body>
    <h1 class="title">AI Assistant Plus</h1>
    <div class="content">
        <div id="chatBox">
            <p>有何贵干?</p>
        </div>
        <div class="toolBox">
            <button onclick="clearMessages()" title="Clear Messages">
                <svg viewBox="0 0 24 24" fill="#999" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19.54 3.66c-.13-.49-.45-.9-.89-1.16-.44-.26-.95-.32-1.45-.19-.49.13-.9.45-1.16.89l-3.48 6.03L10.42 8a.738.738 0 0 0-1.02.27L8.28 10.2c-.1.17-.13.38-.08.57.05.19.18.36.35.46l.31.18c-2.21 2.1-6.06 3.64-6.1 3.66-.26.1-.45.35-.47.63-.03.28.11.55.35.7l2.01 1.25c.19.12.42.15.63.08.03-.01.48-.16 1.07-.42-.1.15-.18.24-.18.24-.15.16-.22.39-.2.61.03.22.16.42.35.54l4.99 3.1c.12.08.26.11.4.11.16 0 .32-.05.45-.15.11-.09 2.63-2.04 3.74-6.29l.31.18a.746.746 0 0 0 1.02-.27l1.12-1.93c.1-.17.13-.38.08-.57a.77.77 0 0 0-.35-.46l-2.21-1.27 3.48-6.03c.25-.45.32-.97.19-1.46Zm-7.91 16.56-3.84-2.39c.28-.49.59-1.2.65-2.07a.758.758 0 0 0-.38-.71.747.747 0 0 0-.8.04c-.74.52-1.65.91-2.13 1.09l-.49-.3c1.51-.71 3.96-2.04 5.56-3.7l4.33 2.5c-.69 3.03-2.2 4.84-2.9 5.54Zm4.68-6.26L9.96 10.3l.36-.63 4.15 2.39 2.2 1.27-.36.63Zm1.74-9.6-3.48 6.03-.7-.4 3.48-6.03c.11-.19.36-.26.55-.15a.405.405 0 0 1 .15.55ZM16.75 21.14a1.25 1.25 0 1 0 0-2.5 1.25 1.25 0 0 0 0 2.5ZM19 17.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2ZM20.25 19.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z"/>
                </svg>
            </button>
        </div>
        <div class="inputBox">
            <textarea id="inputTextArea" placeholder="今天天气怎么样?"></textarea>
            <button id="sendBtn" onclick="sendMessage()" title="Send">
                <svg viewBox="0 0 24 24" fill="#fff" xmlns="http://www.w3.org/2000/svg">
                    <path d="M5.69362 11.9997L2.29933 3.2715C2.0631 2.66403 2.65544 2.08309 3.2414 2.28959L3.33375 2.32885L21.3337 11.3288C21.852 11.588 21.8844 12.2975 21.4309 12.6129L21.3337 12.6705L3.33375 21.6705C2.75077 21.962 2.11746 21.426 2.2688 20.8234L2.29933 20.7278L5.69362 11.9997L2.29933 3.2715L5.69362 11.9997ZM4.4021 4.54007L7.01109 11.2491L13.6387 11.2497C14.0184 11.2497 14.3322 11.5318 14.3818 11.8979L14.3887 11.9997C14.3887 12.3794 14.1065 12.6932 13.7404 12.7428L13.6387 12.7497L7.01109 12.7491L4.4021 19.4593L19.3213 11.9997L4.4021 4.54007Z"></path>
                </svg>
            </button>
        </div>

    </div>
    <script>
        var renderer = new marked.Renderer();

        renderer.paragraph = function(text) {
          return text;
        };

		var inputTextArea = document.getElementById('inputTextArea');
		var chatBox = document.getElementById('chatBox');
		var sendBtn = document.getElementById('sendBtn');

		inputTextArea.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });

        window.addEventListener("beforeunload", function (event) {
            clearMessages();
        });

		async function clearMessages() {
			var response = await fetch('/api', {
                method: 'DELETE'
            });

            chatBox.innerHTML = '<p>有何贵干?</p>';
			document.cookie = "cookieName=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
			inputTextArea.disabled = false;
			sendBtn.disabled = false;
		}

        async function sendMessage() {
            var message = inputTextArea.value;
            if(message == undefined || message == ''){
                return;
            }
            inputTextArea.value = '';

            var pElement = document.createElement('p');
            pElement.textContent = message;
            chatBox.appendChild(pElement);
            chatBox.scrollTop = chatBox.scrollHeight;

			inputTextArea.disabled = true;
			sendBtn.disabled = true;

            var response = await fetch('/api', {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain'
                },
                body: message
            });

            if (response.ok) {
                var data = await response.text();
                var pElement = document.createElement('p');
                pElement.innerHTML = marked.parse(data, { renderer: renderer });

                // 获取 p 元素中的所有 pre 元素
                var preElements = pElement.getElementsByTagName('pre');

                // 为每个 pre 元素添加点击事件
                for (var i = 0; i < preElements.length; i++) {
                    var copyButton = document.createElement('button');
                    copyButton.textContent = '复制';
                    copyButton.className = 'copy-button';
                    preElements[i].appendChild(copyButton);

                    copyButton.addEventListener('click', function(event) {
                        // 创建一个 textarea 元素，用于复制文本
                        var textarea = document.createElement('textarea');
                        // 将 pre 元素中的文本设置为 textarea 的值
                        textarea.value = event.target.parentNode.textContent.replace('复制', '');
                        // 将 textarea 添加到文档中
                        document.body.appendChild(textarea);
                        // 选中 textarea 中的文本
                        textarea.select();
                        // 执行复制命令
                        document.execCommand('copy');
                        // 从文档中移除 textarea
                        document.body.removeChild(textarea);

                        // 创建一个提示元素
                        var alert = document.createElement('div');
                        alert.textContent = '复制成功！';
                        alert.style.position = 'fixed';
                        alert.style.bottom = '50%';
                        alert.style.left = '50%';
                        alert.style.transform = 'translate(-50%, 50%)';
                        alert.style.backgroundColor = '#20B2AA';
                        alert.style.color = 'white';
                        alert.style.padding = '10px';
                        alert.style.borderRadius = '5px';

                        // 将提示元素添加到文档中
                        document.body.appendChild(alert);

                        // 设置一个定时器，在 2 秒后移除提示元素
                        setTimeout(function() {
                            document.body.removeChild(alert);
                        }, 2000);
                    });
                }

                chatBox.appendChild(pElement);
            } else {
                console.error('Error:', response.status, response.statusText);
                chatBox.innerHTML += '<p>' + response.status + ':' + response.statusText + '</p>';
            }
            chatBox.scrollTop = chatBox.scrollHeight;
			inputTextArea.disabled = false;
			sendBtn.disabled = false;
        }

    </script>
</body>

</html>